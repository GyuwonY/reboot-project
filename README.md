# 선착순 구매 서비스
 다량의 트래픽이 몰리는 상황에서 동시성 제어를 처리하는 개인 프로젝트입니다.  
 결제 페이지에 진입하였을 때 재고를 선점하고 이탈과 결제 완료 등 상황을 고려하여 재고 관리를 하였으며,  
 MSA를 적용하여 도메인 별 확장성을 부여하였습니다.  

## Service Architecture
![service_architecture](https://github.com/user-attachments/assets/5eab5820-93d1-4080-a750-46da42dca3b2)

---
#### 서비스간 통신
각 서비스는 Feign client를 통해 통신하며 Resilience4j Circuit breaker를 사용하여  
서비스간 장애 상태 감지 및 회복 시간 확보가 가능하도록 구축하였습니다.  
  
#### Auth
기기별 DeviceID 를 이용해 각 토큰을 관리하여 다양한 기기에서 로그인 할 수 있는 환경을 제공하도록 구현하였습니다.  
이를 이용하여 기기별 로그인 상태 관리 및 주 기기에서 타 기기 로그아웃 등의 기능까지 확장이 가능합니다.  
  
정책에 따른 비인증 트래픽의 사전 차단을 고려하여 Gateway filter를 통해 토큰 검증 이후 Header 내 정보 추가하여 통신하도록 구현하였습니다.
  
#### 재고 관리
재고는 많은 상황에서 조회 및 수정이 이루어질 것으로 생각되어 개별 서비스 분리하였고 널리 알려진 Redis를 사용하여 재고 Caching 관리하였습니다.  
또한 결제 등에 따른 동시성 관리를 위해 Redis Lock을 사용하였으며, 최종 결제 혹은 취소 등의 상황에서 RDBS에 최종 저장될 수 있도록 관리하였습니다.
  
결제 페이지 진입 후 이탈의 경우를 대비하기 위해 선점은 10분 동안 이루어진다는 정책을 세웠으며, 이를 구현하기 위하여 Redis의 TTL 기능과 Pub/Sub을 통해 발행된 이벤트를 받아 Kafka로 전환하여 선점된 재고를 안정적으로 회복할 수 있도록 구축하였습니다.  
  

